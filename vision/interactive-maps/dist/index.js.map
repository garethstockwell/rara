{"mappings":"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","sources":["src/map/heritage_trail.js","src/component/commentary.js","src/component/map.js","src/component/info.js","src/component/layer.js","src/component/menu.js","src/component/location.js","src/component/route.js","src/layer/buildings.js","src/layer/line.js","src/layer/locations.js"],"sourcesContent":["// Render a map of the heritage trail\n\nimport { Commentary } from \"../component/commentary.js\";\nimport { Map } from \"../component/map.js\";\nimport { Route } from \"../component/route.js\";\n\nimport { addBuildingsLayer } from \"../layer/buildings.js\";\nimport { addLineLayer } from \"../layer/line.js\";\nimport { addLocationsLayer } from \"../layer/locations.js\";\n\nvar route = null;\n\n/**\n * Create the map\n * @param {Object} args The arguments \n * @returns Map\n */\nexport function createMap(args) {\n  args = args ?? {};\n\n  const config = {\n    style: \"/data/style.json\",\n    center: [0.144843, 52.212231],\n    zoom: 15,\n    container: \"map\",\n    attributionControl: false\n  };\n\n  const zOrder = [\n    'boundary',\n    'heritage_trail',\n    'locations',\n    'point',\n  ];\n\n  var map = new Map({\n    config: config,\n    zOrder: zOrder\n  });\n\n  const locations = map.appData.locations;\n\n  map.on('load', () => {\n    map.addSource(\"point\", {\n      type: \"geojson\",\n      data: {\n        type: \"Feature\",\n        properties: {},\n        geometry: {\n          type: \"Point\",\n          coordinates: [0.0, 0.0]\n        }\n      }\n    });\n\n    map.addLayer({\n      id: \"point\",\n      source: \"point\",\n      type: \"circle\",\n      paint: {\n        \"circle-radius\": 10,\n        \"circle-color\": '#ff0000',\n        \"circle-stroke-width\": 2,\n        \"circle-stroke-color\": 'white' }\n    }, map.appData.layers.zOrder.getPosition('point'));\n  });\n\n  map.appData.layers.addLayer(addBuildingsLayer, {\n    id: '3d_buildings',\n    text: '3D buildings',\n    color: '#aaaaaa',\n    visible: true\n  });\n\n  map.appData.layers.addLayer(addLineLayer, {\n    id: 'boundary',\n    text: 'Riverside area boundary',\n    url: '/data/line_boundary.json',\n    color: 'black',\n    visible: false,\n  });\n\n  map.appData.layers.addLayer(addLineLayer, {\n    id: 'heritage_trail',\n    text: 'Heritage trail line',\n    url: '/data/line_heritage_trail.json',\n    color: 'green',\n    callback: (_arguments) => {\n      route = new Route({\n        altitude: 200,\n        distance: 500,\n        lineId: 'heritage_trail',\n        map: map,\n      });\n    },\n    visible: true,\n  });\n\n  map.appData.layers.addLayer(addLocationsLayer, {\n    id: 'locations',\n    text: 'Heritage trail locations',\n    url: '/data/locations.json',\n    tags: ['attractions'],\n    color: 'green',\n    onclick: args.locationOnClick ?? null,\n    visible: true,\n  });\n\n  /**\n   * Fly from source location to destination location\n   * @param {string} fromId Source location identifier\n   * @param {string} toId   Destination location identifier\n   */\n  function fly(fromId, toId) {\n    console.debug(`Fly from ${fromId} to ${toId}`);\n    const fromCoord = locations.getLocation(fromId).data.geometry.coordinates;\n    const toCoord = locations.getLocation(toId).data.geometry.coordinates;\n    console.debug(`Fly from ${fromId} ${fromCoord} to ${toId} ${toCoord}`);\n    if (route) {\n      route.fly(fromCoord, toCoord, 2000);\n    }\n  }\n\n  const commentary = new Commentary({\n    callback: function(oldId, newId) {\n      var hideIds = [oldId];\n      const oldAdditional = document.getElementById(oldId).getAttribute(\"additionalLocations\");\n      if (oldAdditional) {\n        hideIds = hideIds.concat(oldAdditional.split(\" \"));\n      }\n\n      var showIds = [newId];\n      const newAdditional = document.getElementById(newId).getAttribute(\"additionalLocations\");\n      if (newAdditional) {\n        showIds = showIds.concat(newAdditional.split(\" \"));\n      }\n\n      for (const id of hideIds) {\n        locations.getLocation(id).popupVisible = false;\n      }\n\n      for (const id of showIds) {\n        locations.getLocation(id).popupVisible = true;\n      }\n\n      fly(oldId, newId);\n    }\n  });\n\n  commentary.setIndex(0);\n\n  return map;\n}\n","// Commentary component\n\nexport class Commentary {\n  #elems;\n  #elemIds;\n  #index;\n  #activeId;\n  #prevButtons;\n  #prevLabels;\n  #nextButtons;\n  #nextLabels;\n  #callback\n\n  /**\n   * Construct a Commentary object\n   * @param {Object}   args          The arguments\n   * @param {function} args.callback Callback function\n   */\n  constructor(args) {\n    this.#elems = document.querySelectorAll(\".commentary\");\n    this.#elems.forEach(el => el.style = 'display: none;');\n    this.#elemIds = Array.from(this.#elems).map(el => el.id);\n\n    this.#index = 0;\n    this.#activeId = this.#elemIds[this.#index];\n\n    this.#prevButtons = document.querySelectorAll('.prev-button');\n    this.#prevLabels = document.querySelectorAll('.prev-label');\n    this.#nextButtons = document.querySelectorAll('.next-button');\n    this.#nextLabels = document.querySelectorAll('.next-label');\n\n    this.#prevButtons.forEach(el => el.addEventListener('click', (e) => this.#onPrev()));\n    this.#nextButtons.forEach(el => el.addEventListener('click', (e) => this.#onNext()));\n\n    this.#callback = args.callback;\n  }\n\n  /**\n   * Get commentary identifiers\n   */\n  get ids() {\n    return this.#elemIds;\n  }\n\n  /**\n   * Set active identifier\n   * @param {string} id Identifier \n   */\n  setIndex(index) {\n    const oldId = this.#activeId;\n    this.#index = index;\n    this.#activeId = this.#elemIds[this.#index];\n\n    console.debug(`Commentary.setIndex ${index} ${this.#activeId}`);\n\n    document.querySelector('#' + oldId).style.display = 'none';\n    document.querySelector('#' + this.#activeId).style.display = '';\n\n    if (this.#index > 0) {\n      this.#prevButtons.forEach(el => el.style.display = '');\n      this.#prevLabels.forEach(el => el.textContent = document.querySelector(\n        '#' + this.#elemIds[this.#index - 1]).querySelector('h1').textContent);\n    } else {\n      this.#prevButtons.forEach(el => el.style.display = 'none');\n    }\n\n    if (this.#index + 1 < this.#elemIds.length) {\n      this.#nextButtons.forEach(el => el.style.display = '');\n      this.#nextLabels.forEach(el => el.textContent = document.querySelector(\n        '#' + this.#elemIds[this.#index + 1]).querySelector('h1').textContent);\n    } else {\n      this.#nextButtons.forEach(el => el.style.display = 'none');\n    }\n\n    if (this.#callback) {\n      this.#callback(oldId, this.#activeId);\n    }\n  }\n\n  #onPrev() {\n    this.setIndex((this.#index - 1 + this.#elemIds.length) % this.#elemIds.length);\n  }\n\n  #onNext() {\n    this.setIndex((this.#index + 1) % this.#elemIds.length);\n  }\n}","// Map component\n\nimport { Info } from \"../component/info.js\";\nimport { LayerManager } from \"../component/layer.js\";\nimport { Menu } from \"../component/menu.js\";\nimport { LocationManager } from \"../component/location.js\";\n\n\nfunction addNavigationControl(map) {\n  map.addControl(new maplibregl.NavigationControl({\n    visualizePitch: true,\n    visualizeRoll: true,\n    showZoom: true,\n    showCompass: true\n  }));\n\n  map.addControl(new maplibregl.FullscreenControl());\n\n  map.addControl(new maplibregl.ScaleControl(), 'bottom-right');\n\n  function onZoom(e) {\n    setTimeout(function() { info.update(map); }, 700);\n  }\n\n  document.getElementsByClassName('maplibregl-ctrl-zoom-in')[0].addEventListener('click', onZoom);\n  document.getElementsByClassName('maplibregl-ctrl-zoom-out')[0].addEventListener('click', onZoom);\n}\n\n\n/**\n * Create a Map\n * @param {Object}        args        The arguments\n * @param {Object}        args.config Map configuration\n * @param {Array<string>} args.zOrder List of layer IDs, lowest to highest\n */\nexport function Map(args) {\n  console.debug(\"Map\", args);\n\n  const map = new maplibregl.Map(args.config);\n\n  const info = new Info({\n    map: map,\n  });\n\n  const menu = new Menu();\n\n  const layerManager = new LayerManager({\n    map: map,\n    menu: menu,\n    zOrder: args.zOrder ?? [],\n  });\n\n  const locationManager = new LocationManager({\n    map: map,\n  })\n  \n  map.appData = {\n    layers: layerManager,\n    locations: locationManager,\n  };\n\n  addNavigationControl(map);\n\n  return map;\n}\n","// Information panel\n\nexport class Info {\n  #elem;\n  #event;\n  #freeze;\n  #map;\n\n  /**\n   * Create an Info panel\n   * @param {Object}         args        The arguments\n   * @param {maplibregl.Map} args.map    The map\n   */\n  constructor(args) {\n    this.#elem = document.getElementById('info');\n    this.#event = null;\n    this.#freeze = false;\n    this.#map = args.map;\n\n    const handleKeyDown = (e) => {\n      if (e.key === \"f\") {\n        this.#freeze = !this.#freeze;\n      }\n\n      if (e.key === \"i\") {\n        this.#toggleVisible();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown, true);\n\n    this.#map.on('mousemove', (e) => {\n      this.#event = e;\n      this.#update();\n    });\n  }\n\n  #toggleVisible() {\n    this.#elem.style.display = this.#elem.style.display == 'block' ? 'none' : 'block';\n  }\n\n  #update() {\n    if (!this.#freeze) {\n      this.#elem.innerHTML =\n        `${\n          // e.point is the x, y coordinates of the mousemove event relative\n          // to the top-left corner of the map\n          this.#event ? JSON.stringify(this.#event.point) : ''} zoom:${this.#map.getZoom()}<br />\n        ${\n          // e.lngLat is the longitude, latitude geographical position of the event\n          this.#event ? JSON.stringify(this.#event.lngLat.wrap()) : ''}`;\n    }\n  }\n}\n\n\n\n","// Layer component\n\n/**\n * Class for managing z-order of a stack of layers\n * Based on https://qubika.com/blog/effectively-manage-layer-order-mapbox-gl-js/\n */\nclass ZOrder {\n  #order;\n\n  /**\n   * Create a ZOrder\n   * @param {maplibregl.Map} map   The map\n   * @param {Array.<string>} order List of layer IDs, lowest to highest\n   */\n  constructor(map, order) {\n    this.#order = order;\n\n    map.on('load', () => {\n      map.addSource('empty', {\n        type: 'geojson',\n        data: { type: 'FeatureCollection', features: [] }\n      })\n\n      for (let i = this.#order.length - 1; i >= 0; i--) {\n        map.addLayer({\n          id: `z-${i}`,\n          type: 'symbol',\n          source: 'empty'\n        }, (i == this.#order.length - 1) ? undefined : `z-${i+1}`)\n      }\n    });\n  }\n\n  /**\n   * Get index of layer\n   * @param {string} layerId \n   * @returns Index of layer\n   */\n  getPosition(layerId) {\n    if (!this.#order.includes(layerId)) {\n      throw new Error(`Layer ${layerId} not included as a sortable layer`);\n    }\n\n    return `z-${this.#order.indexOf(layerId)}`\n  }\n}\n\n\n/**\n * Wrapper around a maplibregl Layer\n */\nclass Layer {\n  #id;\n  #manager;\n  #visible;\n  #callback;\n\n  /**\n   * Create a Layer\n   * @param {LayerManager} manager The parent manager\n   * @param {string}       id      The layer ID\n   * @param {boolean}      visible Layer visibility\n   */\n  constructor(manager, id, visible, callback) {\n    console.debug(`Layer.create id=${id} visible=${visible}`)\n    this.#id = id;\n    this.#manager = manager;\n    this.#visible = visible;\n    this.#callback = callback;\n  }\n\n  set visible(visible) {\n    console.debug(`Layer.setVisible id=${this.#id} visible=${visible}`);\n    this.#visible = visible;\n    this.#onVisibleChange();\n  }\n\n  get visible() {\n    return this.#visible;\n  }\n\n  /**\n   * Callback when map is loaded\n   */\n  onLoaded() {\n    console.debug(`Layer.onLoaded id=${this.#id} visible=${this.visible} callback=${this.#callback}`);\n    this.#onVisibleChange();\n    if (this.#callback) {\n      this.#callback(this.#id);\n    }\n  }\n\n  /**\n   * Toggle visibility\n   * @returns {boolean} Updated visibility\n   */\n  toggleVisible() {\n    console.debug(`Layer.toggleVisible id=${this.#id} visible=${this.visible}`);\n\n    this.visible = this.#manager.map.getLayoutProperty(\n      this.#id,\n      'visibility'\n    ) !== 'visible';\n  \n    return this.visible;\n  }\n\n  #onVisibleChange() {\n    console.debug(`Layer.onVisibleChange id=${this.#id} visible=${this.visible}`);\n    this.#manager.map.setLayoutProperty(\n        this.#id, 'visibility', this.visible ? 'visible' : 'none');\n  }\n}\n\n\n/**\n * Manager of a stack of layers\n */\nexport class LayerManager {\n  #layers;\n  #map;\n  #menu;\n  #zOrder;\n\n  /**\n   * Create a LayerManager\n   * @param {Object}         args        The arguments\n   * @param {maplibregl.Map} args.map    The map\n   * @param {Array<string>}  args.zOrder List of layer IDs, lowest to highest\n   * @param {Menu}           args.menu   The menu\n   */\n  constructor(args) {\n    this.#layers = {};\n    this.#map = args.map;\n    this.#menu = args.menu;\n    this.#zOrder = new ZOrder(args.map, args.zOrder);\n  }\n\n  /**\n   * Get map\n   * @returns {maplibregl.Map}\n   */\n  get map() {\n    return this.#map;\n  }\n\n  /**\n   * Get layer\n   * @param {string} id Layer id\n   * @returns {Layer}\n   */\n  getLayer(id) {\n    return this.#layers[id];\n  }\n\n  /**\n   * Get zOrder\n   * @returns {ZOrder}\n   */\n  get zOrder() {\n    return this.#zOrder;\n  }\n\n  /**\n   * Add a layer\n   * @param {function} addFunc Add layer function \n   * @param {Object}   args    Arguments to pass to addFunc\n   */\n  addLayer(func, args) {\n    args.visible = args.visible ?? true;\n    const layer = this.#addLayer(args.id, args.visible, args.callback);\n\n    args.callback = (id) => { layer.onLoaded(id) };\n    args.zOrder = this.#zOrder;\n    func(this.#map, args);\n\n    const addToMenu = args.addToMenu ?? true;\n    if (addToMenu) {\n      this.#menu.addItem({\n        id: args.id,\n        text: args.text,\n        onclick: () => { return layer.toggleVisible() },\n        active: args.visible,\n        color: args.color,\n      });\n    }\n  }\n\n  #addLayer(id, visible, callback) {\n    const layer = new Layer(this, id, visible, callback);\n    this.#layers[id] = layer;\n    return layer;\n  }\n}\n","// Menu component\n\nexport class Menu {\n  #elem;\n\n  /**\n   * Create a Menu\n   */\n  constructor() {\n    this.#elem = document.getElementById('menu');\n\n    const handleKeyDown = (e) => {\n      if (e.key === \"m\") {\n        this.#toggleVisible();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown, true);\n  }\n\n  /**\n   * Add a menu item\n   * @param {Object}   args         The arguments\n   * @param {string}   args.id      Layer identifier\n   * @param {string}   args.text    Text\n   * @param {function} args.onclick Click handler\n   * @param {boolean}  args.active  Whether item is active\n   * @param {string}   args.color   Item color\n   */\n  addItem(args) {\n    const link = document.createElement('a');\n    link.id = 'menu_' + args.id;\n    link.layerId = args.id;\n    link.href = '#';\n    link.textContent = args.text;\n    link.className = args.active ? 'active' : '';\n    link.onclick = (e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      link.className = args.onclick() ? 'active' : '';\n    };\n  \n    const box = document.createElement('div');\n    box.className = 'box';\n    box.style.backgroundColor = args.color ?? 'transparent';\n    link.appendChild(box);\n  \n    this.#elem.appendChild(link);\n    this.#show();\n  }\n\n  #show() {\n    this.#elem.hidden = false;\n  }\n\n  #toggleVisible() {\n    console.debug(\"Menu.toggleVisible\");\n    this.#elem.hidden = !this.#elem.hidden;\n  }\n}\n","// Location component\n\n\nclass Location {\n  #id;\n  #data;\n  #manager;\n  #popup;\n  #popupVisible;\n  \n  /**\n   * Create a Location\n   * @param {LocationManager} manager The parent manager\n   * @param {string}       id      The location ID\n   * @param {boolean}      visible Location visibility\n   */\n  constructor(manager, id, visible) {\n    console.debug(`Location.create id=${id}`)\n    this.#id = id;\n    this.#data = null;\n    this.#manager = manager;\n    this.#popup = null;\n    this.#popupVisible = false;\n  }\n\n  get data() {\n    return this.#data;\n  }\n\n  get popupVisible() {\n    return this.#popupVisible;\n  }\n\n  set popupVisible(visible) {\n    console.debug(`Location.setPopupVisible id=${this.#id} visible=${visible}`);\n    this.#popupVisible = visible;\n    this.#onPopupVisibleChange();\n  }\n\n  setData(data) {\n    console.debug(`Location.setData id=${this.#id} data=${data}`);\n    this.#data = data;\n    this.#popup = new maplibregl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    });\n\n    this.#popup\n      .setLngLat(data.geometry.coordinates)\n      .setHTML(data.properties.title)\n      .addTo(this.#manager.map);\n\n    this.#onPopupVisibleChange();\n  }\n\n  #onPopupVisibleChange() {\n    console.debug(`Location.onPopupVisibleChange id=${this.#id} visible=${this.popupVisible} popup=${this.#popup}`);\n    if (this.#popup) {\n      this.#popup.getElement().style.visibility = this.popupVisible ? 'visible' : 'hidden';\n    }\n  }\n}\n\n\n/**\n * Manager of a set of locations\n */\nexport class LocationManager {\n  #locations;\n  #map;\n\n  /**\n   * Create a LocationManager\n   * @param {Object}         args        The arguments\n   * @param {maplibregl.Map} args.map    The map\n   */\n  constructor(args) {\n    this.#locations = {};\n    this.#map = args.map;\n  }\n\n  /**\n   * Get map\n   * @returns {maplibregl.Map}\n   */\n  get map() {\n    return this.#map;\n  }\n\n  /**\n   * Get location\n   * @param {string} id Location id\n   * @returns {Location}\n   */\n  getLocation(id) {\n    if (!(id in this.#locations)) {\n      this.#addLocation(id); \n    }\n    return this.#locations[id];\n  }\n\n  #addLocation(id) {\n    console.debug(\"LocationManager.addLocation\", id);\n    const popup = new Location(this, id);\n    this.#locations[id] = popup;\n    return popup;\n  }\n}","// Component which allows camera to fly along a route\n\nexport class Route {\n  #camera;\n  #distance;\n  #map;\n  #route;\n\n  #startTime;\n  #startCoord;\n  #startPoint;\n  #startDistance;\n\n  #stopCoord;\n  #stopPoint;\n  #stopDistance;\n  #reachedStopDistance;\n  \n  #speed;\n  #direction;\n\n  /**\n   * Create a Route\n   * @param {Object}         args           The arguments\n   * @param {boolean}        args.autoStart Start flight as soon as route is loaded\n   * @param {int}            args.altitude  Camera altitude in meters\n   * @param {int}            args.distance  Camera trailing distance in meters\n   * @param {string}         args.lineId    Identifier of line to follow\n   * @param {maplibregl.Map} args.map       The map\n   */\n  constructor(args) {\n    this.#camera = {\n      coord: null,\n      altitude: args.altitude ?? 500,\n      distance: null\n    };\n    this.#distance = args.distance ?? 500;\n    this.#map = args.map;\n    this.#speed = 0.0001;\n  \n    this.#init(args.lineId, args.autoStart ?? false);\n  }\n\n  #init(lineId, autoStart) {\n    var line = this.#map.getSource(lineId);\n    line.getData().then((data) => {\n      console.debug(\"Route loaded\");\n\n      var coordinates = data.features[0].geometry.coordinates;\n      this.#route = turf.lineString(coordinates);\n\n      // calculate camera startpoint\n      //  - compute the direction of the first quater of the route\n      //  - and place the camera in to opposite direction of this point\n      let a = maplibregl.MercatorCoordinate.fromLngLat(coordinates[0]);\n      let b = maplibregl.MercatorCoordinate.fromLngLat(\n        turf.along(this.#route, turf.lineDistance(this.#route) / 4).geometry.coordinates);\n      let dx = b.x - a.x, dy = b.y - a.y;\n      this.#camera.distance = this.#distance ?? Math.hypot(dx, dy);\n      this.#camera.coord = new maplibregl.MercatorCoordinate(a.x - dx, a.y - dy);\n\n      // FIXME! when using flyTo the positioning is not correct\n      this.#map.jumpTo(this.#map.calculateCameraOptionsFromTo(\n        this.#camera.coord.toLngLat(),\n        this.#camera.altitude,\n        coordinates[0]));\n\n      if (autoStart) {\n        console.debug(\"Automatically starting\");\n        this.#start();\n      }\n    });\n  }\n\n  #start() {\n    console.debug(\"Route.start\");\n\n    this.#startDistance = 0;\n    this.#stopDistance = null;\n    this.#reachedStopDistance = false;\n    this.#direction = 1;\n\n    if (this.#startCoord) {\n      console.debug(\"Start coordinates:\", this.#startCoord);\n      const startPoint = turf.point(this.#startCoord);\n      const snappedStartPoint = turf.nearestPointOnLine(this.#route, startPoint);\n      this.#startDistance = snappedStartPoint.properties.location;\n      console.debug(\"Start distance (km):\", this.#startDistance);\n    }\n\n    if (this.#stopCoord) {\n      console.debug(\"Stop coordinates:\", this.#stopCoord);\n      const stopPoint = turf.point(this.#stopCoord);\n      const snappedStopPoint = turf.nearestPointOnLine(this.#route, stopPoint);\n      this.#stopDistance = snappedStopPoint.properties.location;\n      console.debug(\"Stop distance (km):\", this.#stopDistance);\n    }\n\n    if (this.#stopDistance && (this.#stopDistance < this.#startDistance)) {\n      this.#direction = -1;\n    }\n\n    this.#startTime = Date.now();\n\n    this.#advance();\n  }\n\n  #advance() {\n    if (this.#reachedStopDistance) {\n      return;\n    }\n\n    const now = Date.now();\n\n    let elapsedTime = (now - this.#startTime);\n    let currentDistance = this.#startDistance + (elapsedTime * this.#speed * this.#direction);\n\n    if (!this.#stopDistance) {\n      let totalDistance = turf.lineDistance(this.#route);\n      currentDistance = currentDistance % totalDistance;\n    }\n\n    //console.debug('advance currentDistance=', currentDistance, 'stopDistance=', stopDistance);\n\n    let lngLat = turf.along(this.#route, currentDistance).geometry.coordinates;\n    this.#map.getSource('point').setData({ type: 'Point', coordinates: lngLat });\n\n    // Let the camera follow the route\n    let coord = maplibregl.MercatorCoordinate.fromLngLat(lngLat);\n    let dx = coord.x - this.#camera.coord.x, dy = coord.y - this.#camera.coord.y;\n    let delta = Math.hypot(dx, dy) - this.#camera.distance;\n    if (delta > 0) {\n      let a = Math.atan2(dy, dx);\n      this.#camera.coord.x += Math.cos(a) * delta;\n      this.#camera.coord.y += Math.sin(a) * delta;\n    }\n    // FIXME! when using easeTo the positioning is not correct\n    this.#map.jumpTo(this.#map.calculateCameraOptionsFromTo(\n        this.#camera.coord.toLngLat(),\n        this.#camera.altitude,\n        lngLat));\n\n    // Determine whether stop point has been reached\n    if (this.#stopDistance !== null && ((\n        this.#direction > 0 &&\n        currentDistance >= this.#stopDistance\n      ) || (\n        this.#direction < 0 &&\n        currentDistance <= this.#stopDistance\n      ))) {\n      this.#reachedStopDistance = true;\n      console.debug(\"Stopped at distance:\", this.#stopDistance);\n      return;\n    }\n\n    requestAnimationFrame(() => { this.#advance() });\n  };\n\n  /**\n   * Fly from start position to stop position\n   * @param {[float, float]} startPos Start position, expressed as [lat, lng]\n   * @param {[float, float]} stopPos  Stop position, expressed as [lat, lng]\n   */\n  fly(startPos, stopPos) {\n    console.debug('Fly from', startPos, 'to', stopPos);\n\n    this.#startCoord = startPos;\n    this.#stopCoord = stopPos;\n\n    this.#reachedStopDistance = false;\n\n    if (this.#route) {\n      this.#start();\n    }\n  }\n}\n\n","// Add 3D buildings\n\nexport function addBuildingsLayer(map, options) {\n  var id = options.id;\n\n  map.on('load', () => {\n    // Insert the layer beneath any symbol layer.\n    const layers = map.getStyle().layers;\n\n    let labelLayerId;\n    for (let i = 0; i < layers.length; i++) {\n      if (layers[i].type === 'symbol' && 'layout' in layers[i] && layers[i].layout['text-field']) {\n        labelLayerId = layers[i].id;\n        break;\n      }\n    }\n\n    map.addSource(id, {\n      url: `https://tiles.openfreemap.org/planet`,\n      type: 'vector',\n    });\n\n    map.addLayer(\n      {\n        id: id,\n        source: id,\n        'source-layer': 'building',\n        type: 'fill-extrusion',\n        minzoom: 15,\n        filter: ['!=', ['get', 'hide_3d'], true],\n        layout: {\n          'visibility': options.visible ? 'visible' : 'none'\n        },\n        paint: {\n          'fill-extrusion-color': [\n            'interpolate',\n            ['linear'],\n            ['get', 'render_height'], 0, 'lightgray', 200, 'royalblue', 400, 'lightblue'\n          ],\n          'fill-extrusion-height': [\n            'interpolate',\n            ['linear'],\n            ['zoom'],\n            15,\n            0,\n            16,\n            ['get', 'render_height']\n          ],\n          'fill-extrusion-base': ['case',\n            ['>=', ['get', 'zoom'], 16],\n            ['get', 'render_min_height'], 0\n          ]\n        }\n      },\n      labelLayerId\n    );\n\n    if (options.callback) {\n      options.callback(['buildings', id]);\n    }\n  });\n}\n","// Add a map layer which shows a line\n\nexport function addLineLayer(map, options) {\n  var id = options.id;\n\n  map.on('load', () => {\n    fetch(options.url)\n      .then(res => res.json())\n      .then(data => {\n        map.addSource(id, {\n          'type': 'geojson',\n          'data': data\n        });\n\n        map.addLayer({\n          'id': id,\n          'type': 'line',\n          'source': id,\n          'layout': {\n            'line-join': 'round',\n            'line-cap': 'round',\n            'visibility': options.visible ? 'visible' : 'none'\n          },\n          'paint': {\n            'line-color': options.color,\n            'line-width': 6\n          }\n        }, options.zOrder ? options.zOrder.getPosition(id) : null);\n\n        if (options.callback) {\n          options.callback(['line', id]);\n        }\n      }\n    );\n  });\n}\n","// Add a map layer which shows locations\n\n/**\n * Create the map\n * @param {Object} args              The arguments\n */\nexport function addLocationsLayer(map, args) {\n  map.on('load', async () => {\n    var id = args.id;\n\n    const locations = map.appData.locations;\n\n    const image = await map.loadImage('/assets/icons/pin-' + args.color + '.png');\n    map.addImage(id, image.data);\n\n    fetch(args.url)\n      .then(res => res.json())\n      .then(data => {   \n        if (args.tags) {\n          data.features = data.features.filter(\n            feature => args.tags.every((x) => feature.properties.tags.includes(x))\n          );\n        }\n\n        data.features.forEach(feature => {\n          const loc = locations.getLocation(feature.properties.id);\n          loc.setData(feature);\n          if (args.staticPopups) {\n            loc.popupVisible = true;\n          }\n        });\n\n        map.addSource(id, {\n          'type': 'geojson',\n          'data': data\n        });\n\n        map.addLayer({\n          'id': id,\n          'type': 'symbol',\n          'source': id,\n          'layout': {\n            'icon-image': id,\n            'icon-size': 1.0,\n            'icon-allow-overlap': true,\n            'visibility': args.visible ? 'visible' : 'none'\n          }\n        }, args.zOrder ? args.zOrder.getPosition(id) : null);\n\n        if (!args.staticPopups) {\n          // Make sure to detect marker change for overlapping markers\n          // and use mousemove instead of mouseenter event\n          let currentFeatureId = undefined;\n          let currentFeatureCoordinates = undefined;\n          map.on('mousemove', id, (e) => {\n            const featureCoordinates = e.features[0].geometry.coordinates.toString();\n            if (currentFeatureCoordinates !== featureCoordinates) {\n              currentFeatureCoordinates = featureCoordinates;\n\n              // Change the cursor style as a UI indicator.\n              map.getCanvas().style.cursor = 'pointer';\n\n              const coordinates = e.features[0].geometry.coordinates.slice();\n\n              // Ensure that if the map is zoomed out such that multiple\n              // copies of the feature are visible, the popup appears\n              // over the copy being pointed to.\n              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n              }\n\n              if (currentFeatureId) {\n                locations.getLocation(currentFeatureId).popupVisible = false;\n              }\n\n              currentFeatureId = e.features[0].properties.id;\n              locations.getLocation(currentFeatureId).popupVisible = true;\n\n              if (args.onenter) {\n                args.onenter(currentFeatureId);\n              }\n            }\n          });\n\n          map.on('mouseleave', id, () => {\n            const featureId = currentFeatureId;\n\n            /*\n            map.getCanvas().style.cursor = '';\n            locations.getLocation(currentFeatureId).popupVisible = false;\n            currentFeatureId = undefined;\n            currentFeatureCoordinates = undefined;\n            */\n\n            if (args.onleave) {\n              args.onleave(featureId);\n            }\n          });\n        }\n\n        if (args.onclick) {\n          map.on('click', id, (e) => {\n            args.onclick(e.features[0].properties.id);\n          });\n        }\n      }\n    );\n  });\n}\n"],"names":[],"version":3,"file":"index.js.map"}